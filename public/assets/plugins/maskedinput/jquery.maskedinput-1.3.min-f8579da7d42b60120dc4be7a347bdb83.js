/*
	Masked Input plugin for jQuery
	Copyright (c) 2007-2011 Josh Bush (digitalbush.com)
	Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license) 
	Version: 1.3
*/
(function(e){var t=(e.browser.msie?"paste":"input")+".mask",i=void 0!=window.orientation;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn"},e.fn.extend({caret:function(e,t){if(0!=this.length){if("number"==typeof e)return t="number"==typeof t?t:e,this.each(function(){if(this.setSelectionRange)this.setSelectionRange(e,t);else if(this.createTextRange){var i=this.createTextRange();i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",e),i.select()}});if(this[0].setSelectionRange)e=this[0].selectionStart,t=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var i=document.selection.createRange();e=0-i.duplicate().moveStart("character",-1e5),t=e+i.text.length}return{begin:e,end:t}}},unmask:function(){return this.trigger("unmask")},mask:function(n,o){if(!n&&this.length>0){var s=e(this[0]);return s.data(e.mask.dataName)()}o=e.extend({placeholder:"_",completed:null},o);var a=e.mask.definitions,r=[],l=n.length,c=null,u=n.length;return e.each(n.split(""),function(e,t){"?"==t?(u--,l=e):a[t]?(r.push(new RegExp(a[t])),null==c&&(c=r.length-1)):r.push(null)}),this.trigger("unmask").each(function(){function s(e){for(var t=y.val(),i=-1,n=0,s=0;u>n;n++)if(r[n]){for(C[n]=o.placeholder;s++<t.length;){var a=t.charAt(s-1);if(r[n].test(a)){C[n]=a,i=n;break}}if(s>t.length)break}else C[n]==t.charAt(s)&&n!=l&&(s++,i=n);return!e&&l>i+1?(y.val(""),d(0,u)):(e||i+1>=l)&&(h(),e||y.val(y.val().substring(0,i+1))),l?n:c}function h(){return y.val(C.join("")).val()}function d(e,t){for(var i=e;t>i&&u>i;i++)r[i]&&(C[i]=o.placeholder)}function p(e){var t=e.which,i=y.caret();if(e.ctrlKey||e.altKey||e.metaKey||32>t)return!0;if(t){0!=i.end-i.begin&&(d(i.begin,i.end),m(i.begin,i.end-1));var n=b(i.begin-1);if(u>n){var s=String.fromCharCode(t);if(r[n].test(s)){g(n),C[n]=s,h();var a=b(n);y.caret(a),o.completed&&a>=u&&o.completed.call(y)}}return!1}}function f(e){var t=e.which;if(8==t||46==t||i&&127==t){var n=y.caret(),o=n.begin,a=n.end;return 0==a-o&&(o=46!=t?v(o):a=b(o-1),a=46==t?b(a):a),d(o,a),m(o,a-1),!1}return 27==t?(y.val(T),y.caret(0,s()),!1):void 0}function g(e){for(var t=e,i=o.placeholder;u>t;t++)if(r[t]){var n=b(t),s=C[t];if(C[t]=i,!(u>n&&r[n].test(s)))break;i=s}}function m(e,t){if(!(0>e)){for(var i=e,n=b(t);u>i;i++)if(r[i]){if(!(u>n&&r[i].test(C[n])))break;C[i]=C[n],C[n]=o.placeholder,n=b(n)}h(),y.caret(Math.max(c,e))}}function v(e){for(;--e>=0&&!r[e];);return e}function b(e){for(;u>=++e&&!r[e];);return e}var y=e(this),C=e.map(n.split(""),function(e){return"?"!=e?a[e]?o.placeholder:e:void 0}),T=y.val();y.data(e.mask.dataName,function(){return e.map(C,function(e,t){return r[t]&&e!=o.placeholder?e:null}).join("")}),y.attr("readonly")||y.one("unmask",function(){y.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){T=y.val();var t=s();h();var i=function(){t==n.length?y.caret(0,t):y.caret(t)};(e.browser.msie?i:function(){setTimeout(i,0)})()}).bind("blur.mask",function(){s(),y.val()!=T&&y.change()}).bind("keydown.mask",f).bind("keypress.mask",p).bind(t,function(){setTimeout(function(){y.caret(s(!0))},0)}),s()})}})})(jQuery);
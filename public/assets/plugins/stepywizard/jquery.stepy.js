(function(e){var t={init:function(i){return this.each(function(){var n=e.extend({},e.fn.stepy.defaults,i),o=e(this).data("options",n),s=o.attr("id");(void 0===s||""==s)&&(s="stepy-"+e("."+o.attr("class")).index(this),o.attr("id",s));var a=e("<ul/>",{id:s+"-titles","class":"stepy-titles"});n.titleTarget?e(n.titleTarget).html(a):a.insertBefore(o),n.validate&&(jQuery.validator.setDefaults({ignore:n.ignore}),o.append('<div class="stepy-error"/>'));var r=o.children("fieldset"),l=void 0,c=void 0,u="",h="";r.each(function(i){l=e(this),l.addClass("step").attr("id",s+"-step-"+i).append('<div id="'+s+"-buttons-"+i+'" class="toolbar bottom clearfix '+s+'-buttons"/>'),c=l.children("legend"),n.legend||c.hide(),u="",n.description&&(c.length?u="<span>"+c.html()+"</span>":e.error(s+": the legend element of the step "+(i+1)+" is required to set the description!")),h=l.attr("title"),h=""!=h?"<div>"+h+"</div>":"--",a.append('<li id="'+s+"-title-"+i+'">'+h+u+"</li>"),0==i?r.length>1&&t.createNextButton.call(o,i):(t.createBackButton.call(o,i),l.hide(),r.length-1>i&&t.createNextButton.call(o,i))});var d=a.children();d.first().addClass("current-step");var p=o.children(".finish");if(n.finishButton)if(p.length){var f=o.is("form"),g=void 0;n.finish&&f&&(g=o.attr("onsubmit"),o.attr("onsubmit","return false;")),p.click(function(e){if(n.finish&&!t.execute.call(o,n.finish,r.length-1))e.preventDefault();else if(f){g?o.attr("onsubmit",g):o.removeAttr("onsubmit");var i="submit"==p.attr("type");i||n.validate&&!t.validate.call(o,r.length-1)||o.submit()}}),p.appendTo(o.find("div:last"))}else e.error(s+': element with class name "finish" missing!');n.titleClick?d.click(function(){var i=d.filter(".current-step").attr("id").split("-"),s=parseInt(i[i.length-1],10),a=e(this).index();if(a>s){if(n.next&&!t.execute.call(o,n.next,a))return!1}else if(s>a&&n.back&&!t.execute.call(o,n.back,a))return!1;a!=s&&t.step.call(o,a+1)}):d.css("cursor","default"),r.delegate('input[type="text"], input[type="password"]',"keypress",function(t){var i=t.keyCode?t.keyCode:t.which;if(13==i){t.preventDefault();var n=e(this).parent().children("."+s+"-buttons");if(n.length){var o=n.children(".button-next");if(o.length)o.click();else{var a=n.children(".finish");a.length&&a.click()}}}})})},createBackButton:function(i){var n=this,o=this.attr("id"),s=this.data("options");e("<a/>",{id:o+"-back-"+i,href:"javascript:void(0);","class":"btn btn-primary button-back",html:s.backLabel}).click(function(){(!s.back||t.execute.call(n,s.back,i-1))&&t.step.call(n,i-1+1)}).appendTo(e("#"+o+"-buttons-"+i))},createNextButton:function(i){var n=this,o=this.attr("id"),s=this.data("options");e("<a/>",{id:o+"-next-"+i,href:"javascript:void(0);","class":"btn btn-primary button-next",html:s.nextLabel}).click(function(){(!s.next||t.execute.call(n,s.next,i+1))&&t.step.call(n,i+1+1)}).appendTo(e("#"+o+"-buttons-"+i))},execute:function(e,t){var i=e.call(this,t+1);return i||void 0===i},step:function(i){i--;var n=this.children("fieldset");i>n.length-1&&(i=n.length-1);var o=this.data("options");if(max=i,o.validate)for(var s=!0,a=0;i>a;a++)if(s&=t.validate.call(this,a),o.block&&!s){max=a;break}n.hide().eq(max).fadeIn("300");var r=e("#"+this.attr("id")+"-titles").children();if(r.removeClass("current-step").eq(max).addClass("current-step"),this.is("form")){var l=void 0;l=max==i?n.eq(max).find(":input:enabled:visible"):n.eq(max).find(".error").select().focus(),l.first().select().focus()}return o.select&&o.select.call(this,max+1),this},validate:function(t){if(!this.is("form"))return!0;var i=this.children("fieldset").eq(t),n=!0,o=e("#"+this.attr("id")+"-titles").children().eq(t),s=this.data("options"),a=this.validate();return e(i.find(":input:enabled").get().reverse()).each(function(){var t=a.element(e(this));void 0===t&&(t=!0),n&=t,n?s.errorImage&&o.removeClass("error-image"):(s.errorImage&&o.addClass("error-image"),a.focusInvalid())}),n}};e.fn.stepy=function(i){return t[i]?t[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(e.error("Method "+i+" does not exist!"),void 0):t.init.apply(this,arguments)},e.fn.stepy.defaults={back:void 0,backLabel:"Back",block:!1,description:!0,errorImage:!1,finish:void 0,finishButton:!0,legend:!0,ignore:"",next:void 0,nextLabel:"Next",titleClick:!1,titleTarget:void 0,validate:!1,select:void 0}})(jQuery);
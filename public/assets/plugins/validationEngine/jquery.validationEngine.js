/*
 * Inline Form Validation Engine 2.6, jQuery plugin
 *
 * Copyright(c) 2010, Cedric Dugas
 * http://www.position-absolute.com
 *
 * 2.0 Rewrite by Olivier Refalo
 * http://www.crionics.com
 *
 * Form validation engine allowing custom regex rules to be added.
 * Licensed under the MIT License
 */
(function(e){"use strict";var t={init:function(i){var n=this;return n.data("jqv")&&null!=n.data("jqv")||(i=t._saveOptions(n,i),e(".formError").live("click",function(){e(this).fadeOut(150,function(){e(this).parent(".formErrorOuter").remove(),e(this).remove()})})),this},attach:function(i){if(!e(this).is("form"))return alert("Sorry, jqv.attach() only applies to a form"),this;var n,o=this;return n=i?t._saveOptions(o,i):o.data("jqv"),n.validateAttribute=o.find("[data-validation-engine*=validate]").length?"data-validation-engine":"class",n.binded&&(o.find("["+n.validateAttribute+"*=validate]").not("[type=checkbox]").not("[type=radio]").not(".datepicker").bind(n.validationEventTrigger,t._onFieldEvent),o.find("["+n.validateAttribute+"*=validate][type=checkbox],["+n.validateAttribute+"*=validate][type=radio]").bind("click",t._onFieldEvent),o.find("["+n.validateAttribute+"*=validate][class*=datepicker]").bind(n.validationEventTrigger,{delay:300},t._onFieldEvent)),n.autoPositionUpdate&&e(window).bind("resize",{noAnimation:!0,formElem:o},t.updatePromptsPosition),o.bind("submit",t._onSubmitEvent),this},detach:function(){if(!e(this).is("form"))return alert("Sorry, jqv.detach() only applies to a form"),this;var i=this,n=i.data("jqv");return i.find("["+n.validateAttribute+"*=validate]").not("[type=checkbox]").unbind(n.validationEventTrigger,t._onFieldEvent),i.find("["+n.validateAttribute+"*=validate][type=checkbox],[class*=validate][type=radio]").unbind("click",t._onFieldEvent),i.unbind("submit",t.onAjaxFormComplete),i.find("["+n.validateAttribute+"*=validate]").not("[type=checkbox]").die(n.validationEventTrigger,t._onFieldEvent),i.find("["+n.validateAttribute+"*=validate][type=checkbox]").die("click",t._onFieldEvent),i.die("submit",t.onAjaxFormComplete),i.removeData("jqv"),n.autoPositionUpdate&&e(window).unbind("resize",t.updatePromptsPosition),this},validate:function(){var i=e(this),n=null;if(i.is("form")&&!i.hasClass("validating")){i.addClass("validating");var o=i.data("jqv");n=t._validateFields(this),setTimeout(function(){i.removeClass("validating")},100),n&&o.onFormSuccess?o.onFormSuccess():!n&&o.onFormFailure&&o.onFormFailure()}else if(i.is("form"))i.removeClass("validating");else{var s=i.closest("form"),o=s.data("jqv");n=t._validateField(i,o),n&&o.onFieldSuccess?o.onFieldSuccess():o.onFieldFailure&&o.InvalidFields.length>0&&o.onFieldFailure()}return n},updatePromptsPosition:function(i){if(i&&this==window)var n=i.data.formElem,o=i.data.noAnimation;else var n=e(this.closest("form"));var s=n.data("jqv");return n.find("["+s.validateAttribute+"*=validate]").not(":disabled").each(function(){var i=e(this);s.prettySelect&&i.is(":hidden")&&(i=n.find("#"+s.usePrefix+i.attr("id")+s.useSuffix));var a=t._getPrompt(i),r=e(a).find(".formErrorContent").html();a&&t._updatePrompt(i,e(a),r,void 0,!1,s,o)}),this},showPrompt:function(e,i,n,o){var s=this.closest("form"),a=s.data("jqv");return a||(a=t._saveOptions(this,a)),n&&(a.promptPosition=n),a.showArrow=1==o,t._showPrompt(this,e,i,!1,a),this},hide:function(){var i,n=e(this).closest("form"),o=n.data("jqv"),s=o&&o.fadeDuration?o.fadeDuration:.3;return i=e(this).is("form")?"parentForm"+t._getClassName(e(this).attr("id")):t._getClassName(e(this).attr("id"))+"formError",e("."+i).fadeTo(s,.3,function(){e(this).parent(".formErrorOuter").remove(),e(this).remove()}),this},hideAll:function(){var t=this,i=t.data("jqv"),n=i?i.fadeDuration:.3;return e(".formError").fadeTo(n,.3,function(){e(this).parent(".formErrorOuter").remove(),e(this).remove()}),this},_onFieldEvent:function(i){var n=e(this),o=n.closest("form"),s=o.data("jqv");s.eventTrigger="field",window.setTimeout(function(){t._validateField(n,s),0==s.InvalidFields.length&&s.onFieldSuccess?s.onFieldSuccess():s.InvalidFields.length>0&&s.onFieldFailure&&s.onFieldFailure()},i.data?i.data.delay:0)},_onSubmitEvent:function(){var i=e(this),n=i.data("jqv");n.eventTrigger="submit";var o=t._validateFields(i);return o&&n.ajaxFormValidation?(t._validateFormWithAjax(i,n),!1):n.onValidationComplete?!!n.onValidationComplete(i,o):o},_checkAjaxStatus:function(t){var i=!0;return e.each(t.ajaxValidCache,function(e,t){return t?void 0:(i=!1,!1)}),i},_checkAjaxFieldStatus:function(e,t){return 1==t.ajaxValidCache[e]},_validateFields:function(i){var n=i.data("jqv"),o=!1;i.trigger("jqv.form.validating");var s=null;if(i.find("["+n.validateAttribute+"*=validate]").not(":disabled").each(function(){var a=e(this),r=[];if(0>e.inArray(a.attr("name"),r)){if(o|=t._validateField(a,n),o&&null==s&&(s=a.is(":hidden")&&n.prettySelect?a=i.find("#"+n.usePrefix+t._jqSelector(a.attr("id"))+n.useSuffix):a),n.doNotShowAllErrosOnSubmit)return!1;if(r.push(a.attr("name")),1==n.showOneMessage&&o)return!1}}),i.trigger("jqv.form.result",[o]),o){if(n.scroll){var a=s.offset().top,r=s.offset().left,l=n.promptPosition;if("string"==typeof l&&-1!=l.indexOf(":")&&(l=l.substring(0,l.indexOf(":"))),"bottomRight"!=l&&"bottomLeft"!=l){var c=t._getPrompt(s);c&&(a=c.offset().top)}if(n.isOverflown){var u=e(n.overflownDIV);if(!u.length)return!1;var h=u.scrollTop(),d=-parseInt(u.offset().top);a+=h+d-5;var p=e(n.overflownDIV+":not(:animated)");p.animate({scrollTop:a},1100,function(){n.focusFirstField&&s.focus()})}else e("body,html").stop().animate({scrollTop:a,scrollLeft:r},1100,function(){n.focusFirstField&&s.focus()})}else n.focusFirstField&&s.focus();return!1}return!0},_validateFormWithAjax:function(i,n){var o=i.serialize(),s=n.ajaxmethod?n.ajaxmethod:"GET",a=n.ajaxFormValidationURL?n.ajaxFormValidationURL:i.attr("action"),r=n.dataType?n.dataType:"json";e.ajax({type:s,url:a,cache:!1,dataType:r,data:o,form:i,methods:t,options:n,beforeSend:function(){return n.onBeforeAjaxFormValidation(i,n)},error:function(e,i){t._ajaxError(e,i)},success:function(o){if("json"==r&&o!==!0){for(var s=!1,a=0;o.length>a;a++){var l=o[a],c=l[0],u=e(e("#"+c)[0]);if(1==u.length){var h=l[2];if(1==l[1])if(""!=h&&h){if(n.allrules[h]){var d=n.allrules[h].alertTextOk;d&&(h=d)}t._showPrompt(u,h,"pass",!1,n,!0)}else t._closePrompt(u);else{if(s|=!0,n.allrules[h]){var d=n.allrules[h].alertText;d&&(h=d)}t._showPrompt(u,h,"",!1,n,!0)}}}n.onAjaxFormComplete(!s,i,o,n)}else n.onAjaxFormComplete(!0,i,o,n)}})},_validateField:function(i,n,o){if(i.attr("id")||(i.attr("id","form-validation-field-"+e.validationEngine.fieldIdCounter),++e.validationEngine.fieldIdCounter),i.is(":hidden")&&!n.prettySelect||i.parent().is(":hidden"))return!1;var s=i.attr(n.validateAttribute),a=/validate\[(.*)\]/.exec(s);if(!a)return!1;var r=a[1],l=r.split(/\[|,|\]/),c=!1,u=i.attr("name"),h="",d="",p=!1,f=!1;n.isError=!1,n.showArrow=!0,n.maxErrorsPerField>0&&(f=!0);var g=e(i.closest("form"));for(var m in l)l[m]=l[m].replace(" ",""),""===l[m]&&delete l[m];for(var m=0,v=0;l.length>m;m++){if(f&&v>=n.maxErrorsPerField){if(!p){var b=e.inArray("required",l);p=-1!=b&&b>=m}break}var y=void 0;switch(l[m]){case"required":p=!0,y=t._getErrorMessage(g,i,l[m],l,m,n,t._required);break;case"custom":y=t._getErrorMessage(g,i,l[m],l,m,n,t._custom);break;case"groupRequired":var C="["+n.validateAttribute+"*="+l[m+1]+"]",T=g.find(C).eq(0);if(T[0]!=i[0]){t._validateField(T,n,o),n.showArrow=!0;continue}y=t._getErrorMessage(g,i,l[m],l,m,n,t._groupRequired),y&&(p=!0),n.showArrow=!1;break;case"ajax":y=t._ajax(i,l,m,n),y&&(d="load");break;case"minSize":y=t._getErrorMessage(g,i,l[m],l,m,n,t._minSize);break;case"maxSize":y=t._getErrorMessage(g,i,l[m],l,m,n,t._maxSize);break;case"min":y=t._getErrorMessage(g,i,l[m],l,m,n,t._min);break;case"max":y=t._getErrorMessage(g,i,l[m],l,m,n,t._max);break;case"past":y=t._getErrorMessage(g,i,l[m],l,m,n,t._past);break;case"future":y=t._getErrorMessage(g,i,l[m],l,m,n,t._future);break;case"dateRange":var C="["+n.validateAttribute+"*="+l[m+1]+"]";n.firstOfGroup=g.find(C).eq(0),n.secondOfGroup=g.find(C).eq(1),(n.firstOfGroup[0].value||n.secondOfGroup[0].value)&&(y=t._getErrorMessage(g,i,l[m],l,m,n,t._dateRange)),y&&(p=!0),n.showArrow=!1;break;case"dateTimeRange":var C="["+n.validateAttribute+"*="+l[m+1]+"]";n.firstOfGroup=g.find(C).eq(0),n.secondOfGroup=g.find(C).eq(1),(n.firstOfGroup[0].value||n.secondOfGroup[0].value)&&(y=t._getErrorMessage(g,i,l[m],l,m,n,t._dateTimeRange)),y&&(p=!0),n.showArrow=!1;break;case"maxCheckbox":i=e(g.find("input[name='"+u+"']")),y=t._getErrorMessage(g,i,l[m],l,m,n,t._maxCheckbox);break;case"minCheckbox":i=e(g.find("input[name='"+u+"']")),y=t._getErrorMessage(g,i,l[m],l,m,n,t._minCheckbox);break;case"equals":y=t._getErrorMessage(g,i,l[m],l,m,n,t._equals);break;case"funcCall":y=t._getErrorMessage(g,i,l[m],l,m,n,t._funcCall);break;case"creditCard":y=t._getErrorMessage(g,i,l[m],l,m,n,t._creditCard);break;case"condRequired":y=t._getErrorMessage(g,i,l[m],l,m,n,t._condRequired),void 0!==y&&(p=!0);break;default:}var _=!1;if("object"==typeof y)switch(y.status){case"_break":_=!0;break;case"_error":y=y.message;break;case"_error_no_prompt":return!0;default:}if(_)break;"string"==typeof y&&(h+=y+"<br/>",n.isError=!0,v++)}!p&&1>i.val().length&&(n.isError=!1);var x=i.prop("type");("radio"==x||"checkbox"==x)&&g.find("input[name='"+u+"']").size()>1&&(i=e(g.find("input[name='"+u+"'][type!=hidden]:first")),n.showArrow=!1),i.is(":hidden")&&n.prettySelect&&(i=g.find("#"+n.usePrefix+t._jqSelector(i.attr("id"))+n.useSuffix)),n.isError?t._showPrompt(i,h,d,!1,n):c||t._closePrompt(i),c||i.trigger("jqv.field.result",[i,n.isError,h]);var w=e.inArray(i[0],n.InvalidFields);return-1==w?n.isError&&n.InvalidFields.push(i[0]):n.isError||n.InvalidFields.splice(w,1),t._handleStatusCssClasses(i,n),n.isError},_handleStatusCssClasses:function(e,t){t.addSuccessCssClassToField&&e.removeClass(t.addSuccessCssClassToField),t.addFailureCssClassToField&&e.removeClass(t.addFailureCssClassToField),t.addSuccessCssClassToField&&!t.isError&&e.addClass(t.addSuccessCssClassToField),t.addFailureCssClassToField&&t.isError&&e.addClass(t.addFailureCssClassToField)},_getErrorMessage:function(i,n,o,s,a,r,l){var c=o;if("custom"==o){var u=jQuery.inArray(o,s)+1,h=s[u];o="custom["+h+"]"}var d,p=n.attr("data-validation-engine")?n.attr("data-validation-engine"):n.attr("class"),f=p.split(" ");if(d="future"==o||"past"==o||"maxCheckbox"==o||"minCheckbox"==o?l(i,n,s,a,r):l(n,s,a,r),void 0!=d){var g=t._getCustomErrorMessage(e(n),f,c,r);g&&(d=g)}return d},_getCustomErrorMessage:function(e,i,n,o){var s=!1,a=t._validityProp[n];if(void 0!=a&&(s=e.attr("data-errormessage-"+a),void 0!=s))return s;if(s=e.attr("data-errormessage"),void 0!=s)return s;var r="#"+e.attr("id");if("undefined"!=typeof o.custom_error_messages[r]&&"undefined"!=typeof o.custom_error_messages[r][n])s=o.custom_error_messages[r][n].message;else if(i.length>0)for(var l=0;i.length>l&&i.length>0;l++){var c="."+i[l];if("undefined"!=typeof o.custom_error_messages[c]&&"undefined"!=typeof o.custom_error_messages[c][n]){s=o.custom_error_messages[c][n].message;break}}return s||"undefined"==typeof o.custom_error_messages[n]||"undefined"==typeof o.custom_error_messages[n].message||(s=o.custom_error_messages[n].message),s},_validityProp:{required:"value-missing",custom:"custom-error",groupRequired:"value-missing",ajax:"custom-error",minSize:"range-underflow",maxSize:"range-overflow",min:"range-underflow",max:"range-overflow",past:"type-mismatch",future:"type-mismatch",dateRange:"type-mismatch",dateTimeRange:"type-mismatch",maxCheckbox:"range-overflow",minCheckbox:"range-underflow",equals:"pattern-mismatch",funcCall:"custom-error",creditCard:"pattern-mismatch",condRequired:"value-missing"},_required:function(t,i,n,o){switch(t.prop("type")){case"text":case"password":case"textarea":case"file":case"select-one":case"select-multiple":default:if(!e.trim(t.val())||t.val()==t.attr("data-validation-placeholder")||t.val()==t.attr("placeholder"))return o.allrules[i[n]].alertText;break;case"radio":case"checkbox":var s=t.closest("form"),a=t.attr("name");if(0==s.find("input[name='"+a+"']:checked").size())return 1==s.find("input[name='"+a+"']:visible").size()?o.allrules[i[n]].alertTextCheckboxe:o.allrules[i[n]].alertTextCheckboxMultiple}},_groupRequired:function(i,n,o,s){var a="["+s.validateAttribute+"*="+n[o+1]+"]",r=!1;return i.closest("form").find(a).each(function(){return t._required(e(this),n,o,s)?void 0:(r=!0,!1)}),r?void 0:s.allrules[n[o]].alertText},_custom:function(e,t,i,n){var o,s=t[i+1],a=n.allrules[s];if(!a)return alert("jqv:custom rule not found - "+s),void 0;if(a.regex){var r=a.regex;if(!r)return alert("jqv:custom regex not found - "+s),void 0;var l=new RegExp(r);if(!l.test(e.val()))return n.allrules[s].alertText}else{if(!a.func)return alert("jqv:custom type not allowed "+s),void 0;if(o=a.func,"function"!=typeof o)return alert("jqv:custom parameter 'function' is no function - "+s),void 0;if(!o(e,t,i,n))return n.allrules[s].alertText}},_funcCall:function(e,t,i,n){var o,s=t[i+1];if(s.indexOf(".")>-1){for(var a=s.split("."),r=window;a.length;)r=r[a.shift()];o=r}else o=window[s]||n.customFunctions[s];return"function"==typeof o?o(e,t,i,n):void 0},_equals:function(t,i,n,o){var s=i[n+1];return t.val()!=e("#"+s).val()?o.allrules.equals.alertText:void 0},_maxSize:function(e,t,i,n){var o=t[i+1],s=e.val().length;if(s>o){var a=n.allrules.maxSize;return a.alertText+o+a.alertText2}},_minSize:function(e,t,i,n){var o=t[i+1],s=e.val().length;if(o>s){var a=n.allrules.minSize;return a.alertText+o+a.alertText2}},_min:function(e,t,i,n){var o=parseFloat(t[i+1]),s=parseFloat(e.val());if(o>s){var a=n.allrules.min;return a.alertText2?a.alertText+o+a.alertText2:a.alertText+o}},_max:function(e,t,i,n){var o=parseFloat(t[i+1]),s=parseFloat(e.val());if(s>o){var a=n.allrules.max;return a.alertText2?a.alertText+o+a.alertText2:a.alertText+o}},_past:function(i,n,o,s,a){var r,l=o[s+1],c=e(i.find("input[name='"+l.replace(/^#+/,"")+"']"));if("now"==l.toLowerCase())r=new Date;else if(void 0!=c.val()){if(c.is(":disabled"))return;r=t._parseDate(c.val())}else r=t._parseDate(l);var u=t._parseDate(n.val());if(u>r){var h=a.allrules.past;return h.alertText2?h.alertText+t._dateToString(r)+h.alertText2:h.alertText+t._dateToString(r)}},_future:function(i,n,o,s,a){var r,l=o[s+1],c=e(i.find("input[name='"+l.replace(/^#+/,"")+"']"));if("now"==l.toLowerCase())r=new Date;else if(void 0!=c.val()){if(c.is(":disabled"))return;r=t._parseDate(c.val())}else r=t._parseDate(l);var u=t._parseDate(n.val());if(r>u){var h=a.allrules.future;return h.alertText2?h.alertText+t._dateToString(r)+h.alertText2:h.alertText+t._dateToString(r)}},_isDate:function(e){var t=new RegExp(/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(?:(?:0?[1-9]|1[0-2])(\/|-)(?:0?[1-9]|1\d|2[0-8]))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(0?2(\/|-)29)(\/|-)(?:(?:0[48]00|[13579][26]00|[2468][048]00)|(?:\d\d)?(?:0[48]|[2468][048]|[13579][26]))$/);return t.test(e)},_isDateTime:function(e){var t=new RegExp(/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1}$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^((1[012]|0?[1-9]){1}\/(0?[1-9]|[12][0-9]|3[01]){1}\/\d{2,4}\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1})$/);return t.test(e)},_dateCompare:function(e,t){return new Date(e.toString())<new Date(t.toString())},_dateRange:function(e,i,n,o){return!o.firstOfGroup[0].value&&o.secondOfGroup[0].value||o.firstOfGroup[0].value&&!o.secondOfGroup[0].value?o.allrules[i[n]].alertText+o.allrules[i[n]].alertText2:t._isDate(o.firstOfGroup[0].value)&&t._isDate(o.secondOfGroup[0].value)?t._dateCompare(o.firstOfGroup[0].value,o.secondOfGroup[0].value)?void 0:o.allrules[i[n]].alertText+o.allrules[i[n]].alertText2:o.allrules[i[n]].alertText+o.allrules[i[n]].alertText2},_dateTimeRange:function(e,i,n,o){return!o.firstOfGroup[0].value&&o.secondOfGroup[0].value||o.firstOfGroup[0].value&&!o.secondOfGroup[0].value?o.allrules[i[n]].alertText+o.allrules[i[n]].alertText2:t._isDateTime(o.firstOfGroup[0].value)&&t._isDateTime(o.secondOfGroup[0].value)?t._dateCompare(o.firstOfGroup[0].value,o.secondOfGroup[0].value)?void 0:o.allrules[i[n]].alertText+o.allrules[i[n]].alertText2:o.allrules[i[n]].alertText+o.allrules[i[n]].alertText2},_maxCheckbox:function(e,t,i,n,o){var s=i[n+1],a=t.attr("name"),r=e.find("input[name='"+a+"']:checked").size();return r>s?(o.showArrow=!1,o.allrules.maxCheckbox.alertText2?o.allrules.maxCheckbox.alertText+" "+s+" "+o.allrules.maxCheckbox.alertText2:o.allrules.maxCheckbox.alertText):void 0},_minCheckbox:function(e,t,i,n,o){var s=i[n+1],a=t.attr("name"),r=e.find("input[name='"+a+"']:checked").size();return s>r?(o.showArrow=!1,o.allrules.minCheckbox.alertText+" "+s+" "+o.allrules.minCheckbox.alertText2):void 0},_creditCard:function(e,t,i,n){var o=!1,s=e.val().replace(/ +/g,"").replace(/-+/g,""),a=s.length;if(a>=14&&16>=a&&parseInt(s)>0){var r,l=0,i=a-1,c=1,u=new String;do r=parseInt(s.charAt(i)),u+=0==c++%2?2*r:r;while(--i>=0);for(i=0;u.length>i;i++)l+=parseInt(u.charAt(i));o=0==l%10}return o?void 0:n.allrules.creditCard.alertText},_ajax:function(i,n,o,s){var a=n[o+1],r=s.allrules[a],l=r.extraData,c=r.extraDataDynamic,u={fieldId:i.attr("id"),fieldValue:i.val()};if("object"==typeof l)e.extend(u,l);else if("string"==typeof l)for(var h=l.split("&"),o=0;h.length>o;o++){var d=h[o].split("=");d[0]&&d[0]&&(u[d[0]]=d[1])}if(c)for(var p=String(c).split(","),o=0;p.length>o;o++){var f=p[o];if(e(f).length){var g=i.closest("form").find(f).val();f.replace("#","")+"="+escape(g),u[f.replace("#","")]=g}}return"field"==s.eventTrigger&&delete s.ajaxValidCache[i.attr("id")],s.isError||t._checkAjaxFieldStatus(i.attr("id"),s)?void 0:(e.ajax({type:s.ajaxFormValidationMethod,url:r.url,cache:!1,dataType:"json",data:u,field:i,rule:r,methods:t,options:s,beforeSend:function(){},error:function(e,i){t._ajaxError(e,i)},success:function(n){var o=n[0],a=e("#"+o+"']").eq(0);if(1==a.length){var l=n[1],c=n[2];if(l){if(s.ajaxValidCache[o]=!0,c){if(s.allrules[c]){var u=s.allrules[c].alertTextOk;u&&(c=u)}}else c=r.alertTextOk;c?t._showPrompt(a,c,"pass",!0,s):t._closePrompt(a),"submit"==s.eventTrigger&&i.closest("form").submit()}else{if(s.ajaxValidCache[o]=!1,s.isError=!0,c){if(s.allrules[c]){var u=s.allrules[c].alertText;u&&(c=u)}}else c=r.alertText;t._showPrompt(a,c,"",!0,s)}}a.trigger("jqv.field.result",[a,s.isError,c])}}),r.alertTextLoad)},_ajaxError:function(e,t){0==e.status&&null==t?alert("The page is not served from a server! ajax call failed"):"undefined"!=typeof console&&console.log("Ajax error: "+e.status+" "+t)},_dateToString:function(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},_parseDate:function(e){var t=e.split("-");return t==e&&(t=e.split("/")),new Date(t[0],t[1]-1,t[2])},_showPrompt:function(e,i,n,o,s,a){var r=t._getPrompt(e);a&&(r=!1),r?t._updatePrompt(e,r,i,n,o,s):t._buildPrompt(e,i,n,o,s)},_buildPrompt:function(i,n,o,s,a){var r=e("<div>");switch(r.addClass(t._getClassName(i.attr("id"))+"formError"),r.addClass("parentForm"+t._getClassName(i.parents("form").attr("id"))),r.addClass("formError"),o){case"pass":r.addClass("greenPopup");break;case"load":r.addClass("blackPopup");break;default:}if(s&&r.addClass("ajaxed"),e("<div>").addClass("formErrorContent").html(n).appendTo(r),a.showArrow){var l=e("<div>").addClass("formErrorArrow"),c=i.data("promptPosition")||a.promptPosition;if("string"==typeof c){var u=c.indexOf(":");-1!=u&&(c=c.substring(0,u))}switch(c){case"bottomLeft":case"bottomRight":r.find(".formErrorContent").before(l),l.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --></div><div class="line2"><!-- --></div><div class="line3"><!-- --></div><div class="line4"><!-- --></div><div class="line5"><!-- --></div><div class="line6"><!-- --></div><div class="line7"><!-- --></div><div class="line8"><!-- --></div><div class="line9"><!-- --></div><div class="line10"><!-- --></div>');break;case"topLeft":case"topRight":l.html('<div class="line10"><!-- --></div><div class="line9"><!-- --></div><div class="line8"><!-- --></div><div class="line7"><!-- --></div><div class="line6"><!-- --></div><div class="line5"><!-- --></div><div class="line4"><!-- --></div><div class="line3"><!-- --></div><div class="line2"><!-- --></div><div class="line1"><!-- --></div>'),r.append(l)}}i.closest(".ui-dialog").length&&r.addClass("formErrorInsideDialog"),r.css({opacity:0,position:"absolute"}),i.before(r);var u=t._calculatePosition(i,r,a);return r.css({top:u.callerTopPosition,left:u.callerleftPosition,marginTop:u.marginTopSize,opacity:0}).data("callerField",i),a.autoHidePrompt&&setTimeout(function(){r.animate({opacity:0},function(){r.closest(".formErrorOuter").remove(),r.remove()})},a.autoHideDelay),r.animate({opacity:.87})},_updatePrompt:function(e,i,n,o,s,a,r){if(i){"undefined"!=typeof o&&("pass"==o?i.addClass("greenPopup"):i.removeClass("greenPopup"),"load"==o?i.addClass("blackPopup"):i.removeClass("blackPopup")),s?i.addClass("ajaxed"):i.removeClass("ajaxed"),i.find(".formErrorContent").html(n);var l=t._calculatePosition(e,i,a),c={top:l.callerTopPosition,left:l.callerleftPosition,marginTop:l.marginTopSize};r?i.css(c):i.animate(c)}},_closePrompt:function(e){var i=t._getPrompt(e);i&&i.fadeTo("fast",0,function(){i.parent(".formErrorOuter").remove(),i.remove()})},closePrompt:function(e){return t._closePrompt(e)},_getPrompt:function(i){var n=e(i).closest("form").attr("id"),o=t._getClassName(i.attr("id"))+"formError",s=e("."+t._escapeExpression(o)+".parentForm"+n)[0];return s?e(s):void 0},_escapeExpression:function(e){return e.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1")},isRTL:function(t){var i=e(document),n=e("body"),o=t&&t.hasClass("rtl")||t&&"rtl"===(t.attr("dir")||"").toLowerCase()||i.hasClass("rtl")||"rtl"===(i.attr("dir")||"").toLowerCase()||n.hasClass("rtl")||"rtl"===(n.attr("dir")||"").toLowerCase();return Boolean(o)},_calculatePosition:function(e,t,i){var n,o,s,a=e.width(),r=e.position().left,l=e.position().top;e.height();var c=t.height();n=o=0,s=-c;var u=e.data("promptPosition")||i.promptPosition,h="",d="",p=0,f=0;switch("string"==typeof u&&-1!=u.indexOf(":")&&(h=u.substring(u.indexOf(":")+1),u=u.substring(0,u.indexOf(":")),-1!=h.indexOf(",")&&(d=h.substring(h.indexOf(",")+1),h=h.substring(0,h.indexOf(",")),f=parseInt(d),isNaN(f)&&(f=0)),p=parseInt(h),isNaN(h)&&(h=0)),u){default:case"topRight":o+=r+a-30,n+=l;break;case"topLeft":n+=l,o+=r;break;case"centerRight":n=l+4,s=0,o=r+e.outerWidth(!0)+5;break;case"centerLeft":o=r-(t.width()+2),n=l+4,s=0;break;case"bottomLeft":n=l+e.height()+5,s=0,o=r;break;case"bottomRight":o=r+a-30,n=l+e.height()+5,s=0}return o+=p,n+=f,{callerTopPosition:n+"px",callerleftPosition:o+"px",marginTopSize:s+"px"}},_saveOptions:function(t,i){if(e.validationEngineLanguage)var n=e.validationEngineLanguage.allRules;else e.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page");e.validationEngine.defaults.allrules=n;var o=e.extend(!0,{},e.validationEngine.defaults,i);return t.data("jqv",o),o},_getClassName:function(e){return e?e.replace(/:/g,"_").replace(/\./g,"_"):void 0},_jqSelector:function(e){return e.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1")},_condRequired:function(e,i,n,o){var s,a;for(s=n+1;i.length>s;s++)if(a=jQuery("#"+i[s]).first(),a.length&&void 0==t._required(a,["required"],0,o))return t._required(e,["required"],0,o)}};e.fn.validationEngine=function(i){var n=e(this);return n[0]?"string"==typeof i&&"_"!=i.charAt(0)&&t[i]?("showPrompt"!=i&&"hide"!=i&&"hideAll"!=i&&t.init.apply(n),t[i].apply(n,Array.prototype.slice.call(arguments,1))):"object"!=typeof i&&i?(e.error("Method "+i+" does not exist in jQuery.validationEngine"),void 0):(t.init.apply(n,arguments),t.attach.apply(n)):n},e.validationEngine={fieldIdCounter:0,defaults:{validationEventTrigger:"blur",scroll:!0,focusFirstField:!0,promptPosition:"topRight",bindMethod:"bind",inlineAjax:!1,ajaxFormValidation:!1,ajaxFormValidationURL:!1,ajaxFormValidationMethod:"get",onAjaxFormComplete:e.noop,onBeforeAjaxFormValidation:e.noop,onValidationComplete:!1,doNotShowAllErrosOnSubmit:!1,custom_error_messages:{},binded:!0,showArrow:!0,isError:!1,maxErrorsPerField:!1,ajaxValidCache:{},autoPositionUpdate:!1,InvalidFields:[],onFieldSuccess:!1,onFieldFailure:!1,onFormSuccess:!1,onFormFailure:!1,addSuccessCssClassToField:!1,addFailureCssClassToField:!1,autoHidePrompt:!1,autoHideDelay:1e4,fadeDuration:.3,prettySelect:!1,usePrefix:"",useSuffix:"",showOneMessage:!1}},e(function(){e.validationEngine.defaults.promptPosition=t.isRTL()?"topLeft":"topRight"})})(jQuery);